<!DOCTYPE html />

<html>
<head>
	<title>EntityRecord.cs</title>
	<meta http-equiv="content-type" content="text/html; charset=UTF-8" />
	<link href="../nocco.css" rel="stylesheet" media="all" type="text/css" />
	<script src="../prettify.js" type="text/javascript"></script>
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-28613716-1']);
    _gaq.push(['_trackPageview']);

    (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>
</head>
<body onload="prettyPrint()">
	<div id="container">
		<div id="background"></div>
			<div id="jump_to">
				Jump To &hellip;
				<div id="jump_wrapper">
					<div id="jump_page">
							<a class="source" href="../componentkit.html">
								ComponentKit.cs
							</a>
							<a class="source" href="../componentsynceventargs.html">
								ComponentSyncEventArgs.cs
							</a>
							<a class="source" href="../entityeventargs.html">
								EntityEventArgs.cs
							</a>
							<a class="source" href="../icomponent.html">
								IComponent.cs
							</a>
							<a class="source" href="../ientitydefinitioncollection.html">
								IEntityDefinitionCollection.cs
							</a>
							<a class="source" href="../ientityrecord.html">
								IEntityRecord.cs
							</a>
							<a class="source" href="../ientityrecordcollection.html">
								IEntityRecordCollection.cs
							</a>
							<a class="source" href="../isynchronizable.html">
								ISynchronizable.cs
							</a>
							<a class="source" href="../isyncstate.html">
								ISyncState.cs
							</a>
							<a class="source" href="../typeextensions.html">
								TypeExtensions.cs
							</a>
							<a class="source" href="../model/component.html">
								Model\Component.cs
							</a>
							<a class="source" href="../model/componentstateeventargs.html">
								Model\ComponentStateEventArgs.cs
							</a>
							<a class="source" href="../model/dependencycomponent.html">
								Model\DependencyComponent.cs
							</a>
							<a class="source" href="../model/entity.html">
								Model\Entity.cs
							</a>
							<a class="source" href="../model/entitydefinitions.html">
								Model\EntityDefinitions.cs
							</a>
							<a class="source" href="../model/entityrecord.html">
								Model\EntityRecord.cs
							</a>
							<a class="source" href="../model/entityrecordstore.html">
								Model\EntityRecordStore.cs
							</a>
							<a class="source" href="../model/entityregistry.html">
								Model\EntityRegistry.cs
							</a>
							<a class="source" href="../model/requirecomponentattribute.html">
								Model\RequireComponentAttribute.cs
							</a>
					</div>
				</div>
			</div>
		<table cellpadding="0" cellspacing="0">
			<thead>
				<tr>
					<th class="docs">
						<h1>EntityRecord.cs</h1>
					</th>
					<th class="code"></th>
				</tr>
			</thead>
			<tbody>
					<tr id="section_1">
						<td class="docs">
							<div class="pilwrap">
								<a class="pilcrow" href="#section_1">&#182;</a>
							</div>
							<h3>TL;DR..</h3>

						</td>
						<td class="code">
							<pre><code class='prettyprint'>
</code></pre>
						</td>
					</tr>
					<tr id="section_2">
						<td class="docs">
							<div class="pilwrap">
								<a class="pilcrow" href="#section_2">&#182;</a>
							</div>
							<p>This concrete implementation of <code>IEntityRecord</code> is a <strong>struct</strong>, and uses its <strong>Name</strong> property 
to determine equality.</p>

						</td>
						<td class="code">
							<pre><code class='prettyprint'>
</code></pre>
						</td>
					</tr>
					<tr id="section_3">
						<td class="docs">
							<div class="pilwrap">
								<a class="pilcrow" href="#section_3">&#182;</a>
							</div>
							<h2>Source</h2>

						</td>
						<td class="code">
							<pre><code class='prettyprint'>using System;
using System.Dynamic;
using System.Collections.Generic;

namespace ComponentKit.Model {
</code></pre>
						</td>
					</tr>
					<tr id="section_4">
						<td class="docs">
							<div class="pilwrap">
								<a class="pilcrow" href="#section_4">&#182;</a>
							</div>
							<p>Represents a concrete entity that can be entered into a registry.</p>

						</td>
						<td class="code">
							<pre><code class='prettyprint'>    internal struct EntityRecord : IEntityRecord {
        string _name;

</code></pre>
						</td>
					</tr>
					<tr id="section_5">
						<td class="docs">
							<div class="pilwrap">
								<a class="pilcrow" href="#section_5">&#182;</a>
							</div>
							<p>This implementation uses the <code>Name</code> property to determine its identity.</p>

						</td>
						<td class="code">
							<pre><code class='prettyprint'>        public override int GetHashCode() {
            return Name == null ?
                0 : Name.GetHashCode();
        }

        public bool Equals(IEntityRecord other) {
            if (other == null) {
                return false;
            }

</code></pre>
						</td>
					</tr>
					<tr id="section_6">
						<td class="docs">
							<div class="pilwrap">
								<a class="pilcrow" href="#section_6">&#182;</a>
							</div>
							<p>Which is used to determine equality between entities.</p>

						</td>
						<td class="code">
							<pre><code class='prettyprint'>            return GetHashCode() == other.GetHashCode();
        }

        public override bool Equals(object other) {
            if (other == null) {
                return false;
            }

            if (!(other is IEntityRecord)) {
                return false;
            }

            return Equals((EntityRecord)other);
        }

</code></pre>
						</td>
					</tr>
					<tr id="section_7">
						<td class="docs">
							<div class="pilwrap">
								<a class="pilcrow" href="#section_7">&#182;</a>
							</div>
							<p>Gets the unique name identifier for this entity.</p>

						</td>
						<td class="code">
							<pre><code class='prettyprint'>        public string Name {
            get {
                return _name;
            }

</code></pre>
						</td>
					</tr>
					<tr id="section_8">
						<td class="docs">
							<div class="pilwrap">
								<a class="pilcrow" href="#section_8">&#182;</a>
							</div>
							<p>The name is only allowed to be set once. Because the name is used for determining identity, 
being able to mutate it would cause leaks in the <code>Dictionaries</code> containing the entities.</p>

						</td>
						<td class="code">
							<pre><code class='prettyprint'>            set {
                if (_name == null) {
                    _name = value;
                } else {
</code></pre>
						</td>
					</tr>
					<tr id="section_9">
						<td class="docs">
							<div class="pilwrap">
								<a class="pilcrow" href="#section_9">&#182;</a>
							</div>
							<blockquote>
  <p>If you want to rename an entity, it's usually done by simply
  moving the component into a new one.</p>
</blockquote>

						</td>
						<td class="code">
							<pre><code class='prettyprint'>                    throw new InvalidOperationException();
                }
            }
        }

        IEntityRecordCollection _registry;

</code></pre>
						</td>
					</tr>
					<tr id="section_10">
						<td class="docs">
							<div class="pilwrap">
								<a class="pilcrow" href="#section_10">&#182;</a>
							</div>
							<p>Gets the registry that this entity is registered to (when in a synchronized state).</p>

						</td>
						<td class="code">
							<pre><code class='prettyprint'>        public IEntityRecordCollection Registry {
            get {
                return _registry;
            }

            set {
</code></pre>
						</td>
					</tr>
					<tr id="section_11">
						<td class="docs">
							<div class="pilwrap">
								<a class="pilcrow" href="#section_11">&#182;</a>
							</div>
							<p>When set to a different registry, this entity will automatically be registered into the new 
one when synchronized.</p>

						</td>
						<td class="code">
							<pre><code class='prettyprint'>                if (_registry != value) {
</code></pre>
						</td>
					</tr>
					<tr id="section_12">
						<td class="docs">
							<div class="pilwrap">
								<a class="pilcrow" href="#section_12">&#182;</a>
							</div>
							<p>And of course, it is also unregistered from the previous registry if necessary..</p>

						</td>
						<td class="code">
							<pre><code class='prettyprint'>                    if (_registry != null || (value == null &amp;&amp; _registry != null)) {
</code></pre>
						</td>
					</tr>
					<tr id="section_13">
						<td class="docs">
							<div class="pilwrap">
								<a class="pilcrow" href="#section_13">&#182;</a>
							</div>
							<blockquote>
  <p>Note that by switching registry, all attached components will be lost.</p>
</blockquote>

						</td>
						<td class="code">
							<pre><code class='prettyprint'>                        _registry.Drop(this);
                    }
                    
                    _registry = value;
                }
            }
        }

</code></pre>
						</td>
					</tr>
					<tr id="section_14">
						<td class="docs">
							<div class="pilwrap">
								<a class="pilcrow" href="#section_14">&#182;</a>
							</div>
							<p>Creates a new entity with the specified name.</p>

<blockquote>
  <p>The entity will be out-of-sync until it has a registry, so this constructor is usually only used 
  when you need to query the registry for a certain entity (since its name == its identity).</p>
</blockquote>

						</td>
						<td class="code">
							<pre><code class='prettyprint'>        public EntityRecord(string name)
            : this(name, null) { }

</code></pre>
						</td>
					</tr>
					<tr id="section_15">
						<td class="docs">
							<div class="pilwrap">
								<a class="pilcrow" href="#section_15">&#182;</a>
							</div>
							<p>Creates a new entity with the specified name and registers it to the registry.</p>

						</td>
						<td class="code">
							<pre><code class='prettyprint'>        public EntityRecord(string name, IEntityRecordCollection registry)
            : this() {
            Name = name;
            Registry = registry;
        }
        
</code></pre>
						</td>
					</tr>
					<tr id="section_16">
						<td class="docs">
							<div class="pilwrap">
								<a class="pilcrow" href="#section_16">&#182;</a>
							</div>
							<p>The entity is considered out-of-sync when it is not registered in a registry, and/or has no name.</p>

						</td>
						<td class="code">
							<pre><code class='prettyprint'>        public bool IsOutOfSync {
            get {
                return
                    Name == null ||
                    Registry == null ||
                    !Registry.Contains(this);
            }
        }

</code></pre>
						</td>
					</tr>
					<tr id="section_17">
						<td class="docs">
							<div class="pilwrap">
								<a class="pilcrow" href="#section_17">&#182;</a>
							</div>
							<p>Ensures that the entity is registered to its registry.</p>

						</td>
						<td class="code">
							<pre><code class='prettyprint'>        public void Synchronize() {
            if (Name == null) {
                throw new InvalidOperationException();
            }

            if (_registry != null) {
                if (!_registry.Contains(this)) {
                    _registry.Enter(this);
                }
            }
        }

</code></pre>
						</td>
					</tr>
					<tr id="section_18">
						<td class="docs">
							<div class="pilwrap">
								<a class="pilcrow" href="#section_18">&#182;</a>
							</div>
							<p>Gets a component that matches the specified type name, if it is attached to this entity.</p>

						</td>
						<td class="code">
							<pre><code class='prettyprint'>        public IComponent this[string componentNameOrType] {
            get {
                return Registry != null ?
                    Registry.GetComponent(this, Type.GetType(componentNameOrType)) :
                    null;
            }
        }
        
</code></pre>
						</td>
					</tr>
					<tr id="section_19">
						<td class="docs">
							<div class="pilwrap">
								<a class="pilcrow" href="#section_19">&#182;</a>
							</div>
							<p>Broadcasts a message containing arbitrary data to all components attached to this entity.</p>

						</td>
						<td class="code">
							<pre><code class='prettyprint'>        public void Notify&lt;TData&gt;(string message, TData data) {
            if (Registry == null) {
                return;
            }
            
            foreach (IComponent component in this.GetComponents()) {
                component.Receive(message, data);
            }
        }

</code></pre>
						</td>
					</tr>
					<tr id="section_20">
						<td class="docs">
							<div class="pilwrap">
								<a class="pilcrow" href="#section_20">&#182;</a>
							</div>
							<p>Unfortunately, overloading the operators will not work for comparing 2 instances of <code>IEntityRecord</code> 
(which is the exposed interface). 
It sucks, but because this is a compile-time feature, it will only work when comparing instances 
that have been cast to <code>EntityRecord</code>. Not great.</p>

						</td>
						<td class="code">
							<pre><code class='prettyprint'>        public static bool operator ==(EntityRecord left, EntityRecord right) {
            if (Object.ReferenceEquals(left, right)) {
                return true;
            }

            return left.Equals(right);
        }

        public static bool operator !=(EntityRecord left, EntityRecord right) {
            return !(left == right);
        }

        public IEnumerator&lt;IComponent&gt; GetEnumerator() {
            if (Registry == null) {
                return null;
            }

            return Registry.GetComponents(this).GetEnumerator();
        }

        System.Collections.IEnumerator System.Collections.IEnumerable.GetEnumerator() {
            return GetEnumerator();
        }

        public override string ToString() {
            string components = &quot;&quot;;

            foreach (IComponent component in this) {
                components += String.Format(&quot;{0}, &quot;, component.ToString());
            }

            components = components.Remove(components.Length - 2);

            return String.Format(&quot;&#39;{0}&#39;: {{ {1} }}&quot;, Name, components);
        }
    }
}

</code></pre>
						</td>
					</tr>
					<tr id="section_21">
						<td class="docs">
							<div class="pilwrap">
								<a class="pilcrow" href="#section_21">&#182;</a>
							</div>
							<p>Copyright 2012 Jacob H. Hansen.</p>

						</td>
						<td class="code">
							<pre><code class='prettyprint'></code></pre>
						</td>
					</tr>
			</tbody>
		</table>
	</div>
</body>
</html>
